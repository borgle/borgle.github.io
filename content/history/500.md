Title: ［遭遇］“终端服务器客户端访问许可证”不能远程桌面的问题
Date: 2010-11-16 12:59:23
Modified: 2010-11-16 12:59:23
Category: Life
Tags: regedit,注册表,终端许可证
Slug: 500
Authors: Yoker.Wu
Summary: 
    在上海出差转眼就快5个月了，昨天在公司本部办理些事，奈何上海项目有些内容需要处理，于是乎查看邮件按需求调整完成后，直接上[终端服务器](http://www.google.com/search?hl=zh-CN&q=%E7%BB%88%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8&client=pub-9809305251274649) 出现了`由于这台计算机没有终端服务器客户端访问许可证，远程会话被中断，请跟服务器管理员联系`这个错误，直觉认为是权限问题就没管了，让同事待处理后续内容。
    今天回到公司，神奇的错误再次出现，邪门！同事们工作环境一致的，没道理他们可以我不行，何况我也名义上算是个头儿啥。静下心来琢磨了一下，找管事的要了一个内网IP和帐号回到服务器上查看了一下配置，电信的服务器环境配置真的是很迷惑人，最后还是无果！


在上海出差转眼就快5个月了，昨天在公司本部办理些事，奈何上海项目有些内容需要处理，于是乎查看邮件按需求调整完成后，直接上[终端服务器](http://www.google.com/search?hl=zh-CN&q=%E7%BB%88%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8&client=pub-9809305251274649) 出现了`由于这台计算机没有终端服务器客户端访问许可证，远程会话被中断，请跟服务器管理员联系`这个错误，直觉认为是权限问题就没管了，让同事待处理后续内容。

今天回到公司，神奇的错误再次出现，邪门！同事们工作环境一致的，没道理他们可以我不行，何况我也名义上算是个头儿啥。静下心来琢磨了一下，找管事的要了一个内网IP和帐号回到服务器上查看了一下配置，电信的服务器环境配置真的是很迷惑人，最后还是无果！

这个时候我才想起了看看互联网上是否有类似的情况发生，还好有一堆，终于对这个终端授权有了一些了解。解开了心中的迷惑……

    如果某个未经授权的客户端首次连接到终端服务器，终端服务器将向该客户端发出一个临时的终端服务器客户端访问许可证 (CAL) 令牌。用户登录到会话后，终端服务器指示许可证服务器将发出的临时终端服务器 CAL 令牌标记为已验证。在客户端下一次连接时，系统会尝试将已验证的临时终端服务器 CAL 令牌升级为完全终端服务器 CAL 令牌。如果没有许可证令牌可用，则临时终端服务器 CAL 令牌将继续工作 90 天。该许可证存储在客户端的注册表中。 
    
    32 位 RDP 客户端将其许可证存储在`HKEY_LOCAL_MACHINE\Software\Microsoft\MSLicensing`项下。

于是写了下面的注册表文件，导入之后就解决了问题：

```text
Windows Registry Editor Version 5.00

[-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSLicensing]
```

参考地址：

+ <http://hi.baidu.com/aijingfa/blog/item/e348795744f1eac8b645ae15.html>
+ <http://hi.baidu.com/freeserver/blog/item/cf8d81269d35371b8a82a19e.html>
+ <http://hi.baidu.com/xsq521/blog/item/ee7ccdc2483b793ce5dd3bf4.html>